"use strict";var e=require("ora"),s=require("axios"),t=require("fs/promises"),r=require("path"),o=require("sharp"),i=require("fs");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=a(e),c=a(s),u=a(o);class p extends Error{failMessage=void 0;originErrorMessage;constructor(e,s){super(),this.failMessage=e,this.originErrorMessage=s}}let d=n.default(),f=n.default();const l="ic_launcher.png",m="ic_launcher_round.png",g=[{dirname:"mipmap-hdpi",size:72},{dirname:"mipmap-mdpi",size:48},{dirname:"mipmap-xhdpi",size:96},{dirname:"mipmap-xxhdpi",size:144},{dirname:"mipmap-xxxhdpi",size:192}],w={code:1e4,message:"--input参数未输入，请检查--input输入"},h={code:10001,message:"--input配置的远程地址下载失败，请检查路径是否正确与网络环境"},y={code:10002,message:"--input配置的本地地址获取，请检查路径是否正确"},v={code:10003,message:"生成圆角icon资源失败，请检查图标或联系作者"},x={code:10004,message:"生成icon资源失败，请检查文件是否含有相同文件"};async function B(e){await async function(e){try{const s=await c.default({method:"get",url:e,responseType:"arraybuffer"}),t=Buffer.from(s.data);z.updateSourceBuffer(t)}catch(e){throw new p(h,e.message)}}(e)}const z={sourceBuffer:void 0,"--output":"./android/app/src/main/res",updateSourceBuffer(e){this.sourceBuffer=e}};async function S(){switch(z.pathType){case"remote":return void await B(z["--input"]);case"relative":return void await async function(e){try{const s=await t.readFile(r.resolve(process.cwd(),e));z.updateSourceBuffer(s)}catch(e){throw new p(y,e.message)}}(z["--input"]);case"absolute":return void await async function(e){try{const s=await t.readFile(e);z.updateSourceBuffer(s)}catch(e){throw new p(y,e.message)}}(z["--input"]);default:return void console.log("inputSourceType异常")}}async function $(){const e=process.argv.slice(2),s={};e.forEach((e=>{const[t,r]=e.split("=");s[t]=r})),console.log("0001"),await async function(e){if(!e["--input"])throw new p(w,"check --input");console.log("0002"),e["--input"]&&(z["--input"]=e["--input"],z.pathType=function(e){return/^https?:\/\//.test(e)?"remote":e.startsWith("/")?"absolute":"relative"}(e["--input"]),console.log("0003"),await S()),e["--output"]&&(z["--output"]=e["--output"])}(s)}function M(e,s,t,r=50){return new Promise((o=>{const i=Buffer.from(`<svg><rect x="0" y="0" width="${e}" height="${e}" rx="${r}" ry="${r}"/></svg>`);u.default(s).resize(e,e).composite([{input:i,blend:"dest-in"}]).toFile(t,((e,s)=>{if(o(!0),e)throw new p(v,e.message)}))}))}async function b(){try{d.info("Icon Generating In Progress......"),await $(),await async function(){try{const e=z["--output"]||"./",s=z["--input"]||"./public/logo.svg";z.sourceBuffer;for(const o of g){console.log("dsfee1");const a=r.resolve(process.cwd(),e,o.dirname);console.log("dsfee2"),i.existsSync(a)||await t.mkdir(a,{recursive:!0}),console.log("dsfee3"),console.log(process.cwd(),z["--input"]),await M(o.size,r.resolve(process.cwd(),s),r.resolve(process.cwd(),e,o.dirname,l),1),await M(o.size,r.resolve(process.cwd(),e,o.dirname,l),r.resolve(process.cwd(),e,o.dirname,m)),f.succeed(`✅ Generate Success In ${o.dirname}`)}}catch(e){throw new p(x,e.message)}}(),d.stop(),d.succeed("Icon Generating Success")}catch(e){!function(e){const s=n.default();s.fail(`error: ${e.failMessage?.message}, code: ${e.failMessage?.code}, message: ${e?.originErrorMessage}`),s.clear()}(e)}}module.exports=()=>{b()};
